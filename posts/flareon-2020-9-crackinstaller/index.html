<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=author content>
<meta name=description content>
<meta name=keywords content>
<meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=https://starfleetcadet75.github.io/posts/flareon-2020-9-crackinstaller/>
<meta property="og:title" content="Flare-On CTF 2020 Challenge 9: crackinstaller">
<meta property="og:description" content="What kind of crackme doesn&rsquo;t even ask for the password? We need to work on our COMmunication skills.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://starfleetcadet75.github.io/posts/flareon-2020-9-crackinstaller/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-11-11T00:00:00+00:00">
<meta property="article:modified_time" content="2020-11-11T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Flare-On CTF 2020 Challenge 9: crackinstaller">
<meta name=twitter:description content="What kind of crackme doesn&rsquo;t even ask for the password? We need to work on our COMmunication skills.">
<meta itemprop=name content="Flare-On CTF 2020 Challenge 9: crackinstaller">
<meta itemprop=description content="What kind of crackme doesn&rsquo;t even ask for the password? We need to work on our COMmunication skills."><meta itemprop=datePublished content="2020-11-11T00:00:00+00:00">
<meta itemprop=dateModified content="2020-11-11T00:00:00+00:00">
<meta itemprop=wordCount content="1275">
<meta itemprop=keywords content="reversing,windows-drivers,">
<link rel=stylesheet href=/css/layout.css>
<link rel=stylesheet href=/css/default-dark.css>
<link rel=stylesheet href=/css/adoc-html5-extension.css>
<title>
Flare-On CTF 2020 Challenge 9: crackinstaller
</title>
</head>
<body>
<div class=main>
<header>
<div class=header-bar>
<nav>
<div class=siteTitle>
<a href=https://starfleetcadet75.github.io/>starfleetcadet75</a>
</div>
<a class=nav-item href=/about/><div class=nav-item-title>About</div></a>
<a class=nav-item href=/readinglist/><div class=nav-item-title>Reading List</div></a>
<a class="nav-item active" href=/posts/><div class=nav-item-title>Posts</div></a>
</nav>
<div class=social-links-header style=visibility:hidden;display:none>
<a href=mailto:starfleetcadet75@gmail.com><div class=social-link>email</div></a>
<a href=https://github.com/starfleetcadet75 target=_blank><div class=social-link>gh</div></a>
<a href=https://gitlab.com/starfleetcadet75 target=_blank><div class=social-link>gl</div></a>
</div>
</div>
</header>
<article class=post>
<h1 class=title> Flare-On CTF 2020 Challenge 9: crackinstaller </h1>
<div class=content> <h2 id=challenge>Challenge</h2>
<blockquote>
<p>What kind of crackme doesn&rsquo;t even ask for the password?
We need to work on our COMmunication skills.</p>
<p><strong>Bug Notice:</strong> Avoid a possible blue-screen by debugging this on a single core VM</p>
</blockquote>
<h2 id=observations>Observations</h2>
<p>We are provided with a x86_64 PE executable that upsets Windows Defender.
<a href=https://www.virustotal.com/gui/file/b49f6cf962d78785f0d372e50183a6cf333a246e6d9debb7eb1e51af5995fd09/detection>VirusTotal</a> already has plenty of detections for this program and it&rsquo;s behavior tab provides us some useful insight on the sample&rsquo;s functionality.</p>
<p>The program starts a new service called <em>cfs</em>, which probably executes the <a href=https://github.com/starfleetcadet75/writeups/blob/master/2020-Flareon-CTF/crackinstaller/cfs.sys>cfs.dll</a> that was dropped into System32.
There is another embedded DLL called <a href=https://github.com/starfleetcadet75/writeups/blob/master/2020-Flareon-CTF/crackinstaller/credHelper.dll>credHelper.dll</a> that gets dropped to <code>C:\Users\&lt;USER>\AppData\Local\Microsoft\Credentials\credHelper.dll</code>.
It also accesses the registry key <code>HKCR\CLSID\{CEEACC6E-CCB2-4C4F-BCF6-D2176037A9A7}</code>.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/vt_report.PNG alt=vt_report></p>
<p>VirusTotal identifies the hash of cfs.dll <a href=https://www.virustotal.com/gui/file/da6ca1fb539f825ca0f012ed6976baf57ef9c70143b7a1e88b4650bf7a925e24/detection>(da6ca1fb539f825ca0f012ed6976baf57ef9c70143b7a1e88b4650bf7a925e24)</a> as a device driver called <em>Capcom.sys</em>.</p>
<p>A quick search for Capcom leads to <a href=http://www.fuzzysecurity.com/tutorials/28.html>this</a> blog post about the Capcom rootkit that includes a useful <a href=https://github.com/FuzzySecurity/Capcom-Rootkit>Github</a> repository.</p>
<p>There is also an <a href=https://www.theregister.com/2016/09/23/capcom_street_fighter_v/>article</a> that briefly describes its functionality:</p>
<blockquote>
<p>Capcom.sys completely blows this away on Windows: an application simply has to pass control codes 0xAA012044 and 0xAA013044 to the IOCTL, and a pointer to some instructions, and the driver will then jump to that block of code with full kernel permissions.</p>
</blockquote>
<p>The Powershell PoC from FuzzySecurity hints at the functionality of the crackstaller program.
The script also includes a reference to the device name <code>Htsysm72FB</code>, which appeared in the VirusTotal report.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e># Some tricks here</span>
<span style=color:#75715e># =&gt; cmp [rax-8], rcx</span>
echo <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>`n</span><span style=color:#e6db74>[&gt;] Allocating Capcom payload..&#34;</span>
<span style=color:#66d9ef>[IntPtr]</span>$Pointer = <span style=color:#66d9ef>[CapCom]</span>::VirtualAlloc(<span style=color:#66d9ef>[System.IntPtr]</span>::Zero, (8 + $Shellcode.Length), 0x3000, 0x40)
$ExploitBuffer = <span style=color:#66d9ef>[System.BitConverter]</span>::GetBytes($Pointer.ToInt64()+8) + $Shellcode
<span style=color:#66d9ef>[System.Runtime.InteropServices.Marshal]</span>::Copy($ExploitBuffer, 0, $Pointer, (8 + $Shellcode.Length))
echo <span style=color:#e6db74>&#34;[+] Payload size: </span>$(8 + $Shellcode.Length)<span style=color:#e6db74>&#34;</span>
echo <span style=color:#e6db74>&#34;[+] Payload address: </span>$(<span style=color:#e6db74>&#34;{0:X}&#34;</span> <span style=color:#f92672>-f</span> $Pointer.ToInt64())<span style=color:#e6db74>&#34;</span>

$hDevice = <span style=color:#66d9ef>[CapCom]</span>::CreateFile(<span style=color:#e6db74>&#34;\\.\Htsysm72FB&#34;</span>, <span style=color:#66d9ef>[System.IO.FileAccess]</span>::ReadWrite, <span style=color:#66d9ef>[System.IO.FileShare]</span>::ReadWrite, <span style=color:#66d9ef>[System.IntPtr]</span>::Zero, 0x3, 0x40000080, <span style=color:#66d9ef>[System.IntPtr]</span>::Zero)

<span style=color:#66d9ef>if</span> ($hDevice <span style=color:#f92672>-eq</span> -1) {
    echo <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>`n</span><span style=color:#e6db74>[!] Unable to get driver handle..</span><span style=color:#ae81ff>`n</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>Return</span>
} <span style=color:#66d9ef>else</span> {
    echo <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>`n</span><span style=color:#e6db74>[&gt;] Driver information..&#34;</span>
    echo <span style=color:#e6db74>&#34;[+] lpFileName: \\.\Htsysm72FB&#34;</span>
    echo <span style=color:#e6db74>&#34;[+] Handle: $hDevice&#34;</span>
}

<span style=color:#75715e># IOCTL = 0xAA013044</span>
<span style=color:#75715e>#---</span>
$InBuff = <span style=color:#66d9ef>[System.BitConverter]</span>::GetBytes($Pointer.ToInt64()+8)
$OutBuff = 0x1234
echo <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>`n</span><span style=color:#e6db74>[&gt;] Sending buffer..&#34;</span>
echo <span style=color:#e6db74>&#34;[+] Buffer length: </span>$($InBuff.Length)<span style=color:#e6db74>&#34;</span>
echo <span style=color:#e6db74>&#34;[+] IOCTL: 0xAA013044&#34;</span>
<span style=color:#66d9ef>[CapCom]</span>::DeviceIoControl($hDevice, 0xAA013044, $InBuff, $InBuff.Length, <span style=color:#66d9ef>[ref]</span>$OutBuff, 4, <span style=color:#66d9ef>[ref]0, [System.IntPtr]</span>::Zero) |Out-null
</code></pre></div><p>We already know a good deal about this program thanks to some basic OSINT work.
It drops a malicious Windows driver called cfs.dll to disk.
There is actually no need to spend time reversing this driver since we already know that its sole purpose is to execute some shellcode with full kernel permissions.</p>
<h2 id=reversing-crackstallerexe>Reversing Crackstaller.exe</h2>
<p>The crackstaller.exe program performs steps similar to the above Powershell PoC.
It&rsquo;s purpose is to drop the embedded malicious driver and then execute some shellcode with elevated privileges.</p>
<p>It will eventually need to call <code>DeviceIoControl</code> in order to pass the shellcode to cfs.dll.
We can see that there is exactly one place where this happens and that the control code used is 0xAA013044.
The preceeding call to <code>VirtualAlloc</code> likely has something to do with setting up a buffer of shellcode.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/deviceiocontrol.png alt=deviceiocontrol></p>
<p>To extract the contents of the shellcode buffer, we run the program until it reaches the call to <code>DeviceIoControl</code> and then dump the contents at that memory location.
Setting a breakpoint on <code>DeviceIoControl</code>, we can see the header of a PE executable appear in memory.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/dumping_shellcode.png alt=dumping_shellcode></p>
<p>The program is yet another Windows driver.
The following diagram lays out the different components we are dealing with.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/diagram.png alt=diagram></p>
<h2 id=reversing-credhelperdll>Reversing Credhelper.dll</h2>
<p>After running the program to completion with administrator rights, credHelper.dll gets dropped to the location originally mentioned in the VirusTotal report.
It is a COM server that implements a number of boilerplate functions such as <code>DllRegisterServer</code> and <code>DllGetClassObject</code>.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/credhelper_register.PNG alt=credhelper_register></p>
<p>At the end of <code>DllRegisterServer</code> it creates new registry keys at <code>\\Registry\Machine\Software\Classes\CLSID\{CEEACC6E-CCB2-4C4F-BCF6-D2176037A9A7}\Config\Flag</code> and <code>\\Registry\Machine\Software\Classes\CLSID\{CEEACC6E-CCB2-4C4F-BCF6-D2176037A9A7}\Config\Password</code>.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/credhelper_register_keys.png alt=credhelper_register_keys></p>
<p>It looks like the challenge wants us to enter the crackme password in the password registry key and it will then dump the flag to the other key.</p>
<p>A CLSID is a globally unique identifier that identifies the COM class object.
You can find an excellent presentation on how to reverse COM malware <a href=https://github.com/strictlymike/presentations/blob/master/2020/2020.02.08_BSidesHuntsville/2020.02.08_Gophe_v1.5.pdf>here</a>.
This challenge could have been solved by taking a deep dive into COM, but there is a simpler way.</p>
<p>The function at 0x18000153c uses <code>RegGetValueW</code> to access the stored password.
The rest of the function looks like state initialization code for <a href=https://blog.talosintelligence.com/2014/06/an-introduction-to-recognizing-and.html>RC4</a>.
The RC4 state structure is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#66d9ef>struct</span> rc4_state {
    <span style=color:#66d9ef>uint8_t</span> i;
    <span style=color:#66d9ef>uint8_t</span> j;
    <span style=color:#66d9ef>uint8_t</span> perm[<span style=color:#ae81ff>0x100</span>];
};
</code></pre></div><p>Retyping the second function argument, we can now follow where the substitution box is created.
This function only performs the initialization though, the actual xoring of data must occur elsewhere.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/rc4_init.png alt=rc4_init></p>
<p>The following function at 0x1800016d8 generates the key stream and decodes the flag data.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/rc4_decode.png alt=rc4_decode></p>
<p>The RC4 encrypted flag is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>flag_ciphertext <span style=color:#f92672>=</span> [
    <span style=color:#ae81ff>0x16</span>, <span style=color:#ae81ff>0x56</span>, <span style=color:#ae81ff>0xbc</span>, <span style=color:#ae81ff>0x86</span>, <span style=color:#ae81ff>0x9e</span>, <span style=color:#ae81ff>0xe1</span>, <span style=color:#ae81ff>0xd1</span>, <span style=color:#ae81ff>0x02</span>, <span style=color:#ae81ff>0x65</span>, <span style=color:#ae81ff>0xc1</span>, <span style=color:#ae81ff>0x69</span>, <span style=color:#ae81ff>0x9f</span>, <span style=color:#ae81ff>0x10</span>, <span style=color:#ae81ff>0x0a</span>, <span style=color:#ae81ff>0xac</span>, <span style=color:#ae81ff>0xc1</span>,
    <span style=color:#ae81ff>0xf6</span>, <span style=color:#ae81ff>0xe9</span>, <span style=color:#ae81ff>0xfd</span>, <span style=color:#ae81ff>0xb4</span>, <span style=color:#ae81ff>0xcd</span>, <span style=color:#ae81ff>0x22</span>, <span style=color:#ae81ff>0x4a</span>, <span style=color:#ae81ff>0x35</span>, <span style=color:#ae81ff>0x9c</span>, <span style=color:#ae81ff>0x12</span>, <span style=color:#ae81ff>0x73</span>, <span style=color:#ae81ff>0xbd</span>, <span style=color:#ae81ff>0x2b</span>, <span style=color:#ae81ff>0x10</span>, <span style=color:#ae81ff>0x54</span>, <span style=color:#ae81ff>0xb9</span>,
    <span style=color:#ae81ff>0x43</span>, <span style=color:#ae81ff>0xd2</span>, <span style=color:#ae81ff>0x13</span>, <span style=color:#ae81ff>0x9a</span>, <span style=color:#ae81ff>0x84</span>, <span style=color:#ae81ff>0x65</span>, <span style=color:#ae81ff>0xad</span>, <span style=color:#ae81ff>0xb0</span>, <span style=color:#ae81ff>0xbf</span>, <span style=color:#ae81ff>0x5a</span>, <span style=color:#ae81ff>0x81</span>, <span style=color:#ae81ff>0x10</span>
]
</code></pre></div><p>We still need to figure out the correct password in order to decrypt it.</p>
<h2 id=reversing-driversys>Reversing Driver.sys</h2>
<p>The <a href="https://github.com/starfleetcadet75/writeups/blob/master/2020-Flareon-CTF/crackinstaller/driver.sys?raw=true">driver.sys</a> program is fairly small.
It uses <code>CmRegisterCallbackEx</code> to register a callback function that is then called whenever a thread performs an operation on the registry.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/driverentry.PNG alt=driverentry></p>
<p>Inside the callback function, the driver checks whether the triggering registry key started with a specific CLSID.
This is the same CLSID that appears in the credHelper.dll.
This driver functions as a filter driver that filters registry events and only performs an action when the given registry key has been accessed.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/callback_registry_check.PNG alt=callback_registry_check></p>
<p>A <a href=https://github.com/starfleetcadet75/binaryninja-yara>Yara scan</a> for cryptographic constants indicates that the driver can perform SHA-256 hashing and contains the code for a <a href=https://github.com/Ginurx/chacha20-c>ChaCha stream cipher</a>.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/yara_results.png alt=yara_results></p>
<p>The matches indicate that the function at 0x1400034f0 performs state initialization for SHA-256 hashing.
We see that this function is called once and then followed by two related functions calls.
Searching for some simple C implementations on <a href=https://github.com/B-Con/crypto-algorithms/blob/master/sha256.h>Github</a> provides us with the type signatures for these three functions.</p>
<p><img src=https://raw.githubusercontent.com/starfleetcadet75/writeups/master/2020-Flareon-CTF/crackinstaller/hashing.png alt=hashing></p>
<p>The key for the ChaCha20 cipher is the SHA-256 hash of 7 constant bytes of data.
If we try decrypting the password now, we will end up with junk.
It turns out that crackstaller.exe modifies those 7 bytes from <code>[0x23, 0x73, 0xb5, 0xc3, 0xf3, 0x16, 0xdc]</code> to <code>[0x42, 0x42, 0x41, 0x43, 0x41, 0x42, 0x41]</code> as the driver gets loaded.</p>
<h2 id=solution>Solution</h2>
<p>The RC4 encrypted flag is stored inside credHelper.dll.
The password to decrypt it is stored inside of driver.sys and also needs to be decrypted using ChaCha20.
The key for the ChaCha20 cipher is created by hashing 7 bytes from driver.sys.
These bytes are dynamically modified by crackstaller.exe as it loads the driver, adding an additional step to our analysis.</p>
<p>Putting all of these steps together yields the following solution:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> Crypto.Hash <span style=color:#f92672>import</span> SHA256
<span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> ChaCha20
<span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> ARC4

<span style=color:#75715e># From driver.sys at 0x14000608c</span>
<span style=color:#75715e># The original input values are modified dynamically as the driver is loaded</span>
<span style=color:#75715e># [0x23, 0x73, 0xb5, 0xc3, 0xf3, 0x16, 0xdc] -&gt; [0x42, 0x42, 0x41, 0x43, 0x41, 0x42, 0x41]</span>
input_to_sha256 <span style=color:#f92672>=</span> [
    <span style=color:#ae81ff>0x42</span>, <span style=color:#ae81ff>0x42</span>, <span style=color:#ae81ff>0x41</span>, <span style=color:#ae81ff>0x43</span>, <span style=color:#ae81ff>0x41</span>, <span style=color:#ae81ff>0x42</span>, <span style=color:#ae81ff>0x41</span>
]

<span style=color:#75715e># From driver.sys at 0x140006078</span>
input_to_chacha20 <span style=color:#f92672>=</span> [
    <span style=color:#ae81ff>0x10</span>, <span style=color:#ae81ff>0x31</span>, <span style=color:#ae81ff>0xf0</span>, <span style=color:#ae81ff>0x8b</span>, <span style=color:#ae81ff>0x89</span>, <span style=color:#ae81ff>0x4e</span>, <span style=color:#ae81ff>0x73</span>, <span style=color:#ae81ff>0xb5</span>,
    <span style=color:#ae81ff>0x30</span>, <span style=color:#ae81ff>0x47</span>, <span style=color:#ae81ff>0xad</span>, <span style=color:#ae81ff>0x6e</span>, <span style=color:#ae81ff>0x18</span>, <span style=color:#ae81ff>0xa9</span>, <span style=color:#ae81ff>0x5e</span>
]

<span style=color:#75715e># From credHelper.dll at 0x18001a9f0</span>
flag_ciphertext <span style=color:#f92672>=</span> [
    <span style=color:#ae81ff>0x16</span>, <span style=color:#ae81ff>0x56</span>, <span style=color:#ae81ff>0xbc</span>, <span style=color:#ae81ff>0x86</span>, <span style=color:#ae81ff>0x9e</span>, <span style=color:#ae81ff>0xe1</span>, <span style=color:#ae81ff>0xd1</span>, <span style=color:#ae81ff>0x02</span>, <span style=color:#ae81ff>0x65</span>, <span style=color:#ae81ff>0xc1</span>, <span style=color:#ae81ff>0x69</span>, <span style=color:#ae81ff>0x9f</span>,
    <span style=color:#ae81ff>0x10</span>, <span style=color:#ae81ff>0x0a</span>, <span style=color:#ae81ff>0xac</span>, <span style=color:#ae81ff>0xc1</span>, <span style=color:#ae81ff>0xf6</span>, <span style=color:#ae81ff>0xe9</span>, <span style=color:#ae81ff>0xfd</span>, <span style=color:#ae81ff>0xb4</span>, <span style=color:#ae81ff>0xcd</span>, <span style=color:#ae81ff>0x22</span>, <span style=color:#ae81ff>0x4a</span>, <span style=color:#ae81ff>0x35</span>,
    <span style=color:#ae81ff>0x9c</span>, <span style=color:#ae81ff>0x12</span>, <span style=color:#ae81ff>0x73</span>, <span style=color:#ae81ff>0xbd</span>, <span style=color:#ae81ff>0x2b</span>, <span style=color:#ae81ff>0x10</span>, <span style=color:#ae81ff>0x54</span>, <span style=color:#ae81ff>0xb9</span>, <span style=color:#ae81ff>0x43</span>, <span style=color:#ae81ff>0xd2</span>, <span style=color:#ae81ff>0x13</span>, <span style=color:#ae81ff>0x9a</span>,
    <span style=color:#ae81ff>0x84</span>, <span style=color:#ae81ff>0x65</span>, <span style=color:#ae81ff>0xad</span>, <span style=color:#ae81ff>0xb0</span>, <span style=color:#ae81ff>0xbf</span>, <span style=color:#ae81ff>0x5a</span>, <span style=color:#ae81ff>0x81</span>, <span style=color:#ae81ff>0x10</span>
]

h <span style=color:#f92672>=</span> SHA256<span style=color:#f92672>.</span>new()
h<span style=color:#f92672>.</span>update(bytes(input_to_sha256))
key <span style=color:#f92672>=</span> h<span style=color:#f92672>.</span>digest()
nonce <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>
cipher <span style=color:#f92672>=</span> ChaCha20<span style=color:#f92672>.</span>new(key<span style=color:#f92672>=</span>key, nonce<span style=color:#f92672>=</span>nonce)

<span style=color:#75715e># Decrypt the password</span>
password <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(bytes(input_to_chacha20))
print(<span style=color:#e6db74>&#34;Password: &#34;</span> <span style=color:#f92672>+</span> str(password))

<span style=color:#75715e># Use the recovered password to decrypt the flag</span>
cipher <span style=color:#f92672>=</span> ARC4<span style=color:#f92672>.</span>new(password)
flag <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(bytes(flag_ciphertext))
print(<span style=color:#e6db74>&#34;Flag: &#34;</span> <span style=color:#f92672>+</span> str(flag))
</code></pre></div><p><strong>Flag:</strong> <code>S0_m@ny_cl@sse$_in_th3_Reg1stry@flare-on.com</code></p>
</div>
<footer class=post-footer>
<div class=post-footer-data>
<div class=tags>
<div class=tag>
<a href=/tags/reversing>#reversing</a>
</div>
<div class=tag>
<a href=/tags/windows-drivers>#windows-drivers</a>
</div>
</div>
<div class=post-footer-meta>Permalink: <a href=https://starfleetcadet75.github.io/posts/flareon-2020-9-crackinstaller/>/posts/flareon-2020-9-crackinstaller/</a> | Date: 2020-11-11 </div>
<hr>
<div class=categories>
Published in:
<div class=category>
<a href=/categories/writeups>writeups</a>
</div>
</div>
<div class=series>
</div>
</div>
</footer>
</article>
<footer>
<div class=social-links-footer>
<a href=mailto:starfleetcadet75@gmail.com><div class=social-link>Email</div></a>
<a href=https://github.com/starfleetcadet75 target=_blank><div class=social-link>GitHub</div></a>
<a href=https://gitlab.com/starfleetcadet75 target=_blank><div class=social-link>GitLab</div></a>
<div class=social-link>
<a href=https://starfleetcadet75.github.io/index.xml target=_blank>RSS</a>
</div>
</div>
<div class=copyright> </div>
<div class=poweredby>
Powered by <a href=https://gohugo.io/>Hugo</a>.
</div>
</footer>
</div>
</body>
</html>